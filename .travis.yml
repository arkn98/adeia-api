language: go

cache:
  directories:
    - $GOPATH/pkg/mod

go:
  - 1.15.x

os:
  - linux
  - osx
  - windows

env:
  matrix:
    - JOB=test
    - JOB=build

script:
  - 'if [ "${JOB}" = "test" ]; then go test -v -race ./...; fi'
  - 'if [ "${JOB}" = "build" ]; then go build -v ./...; fi'

jobs:
  fast_finish: true
  allow_failures:
    - os: linux
      script: go test -v -coverprofile=coverage.txt -covermode=atomic ./...
      after_success:
        - bash <(curl -s https://codecov.io/bash)
